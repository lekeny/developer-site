---
title: "Authentication"
---

This article explains how to authenticate your API requests to the WaaS service using Cobo Auth.

To ensure secure access to your crypto assets, the WaaS service requires you to use an EdDSA signature to sign each of your API requests, except for publicly accessible API operations.

You need to provide your API key, a nonce, and an API signature as request headers:

```
headers = {
  "Biz-Api-Key": {YOUR_API_KEY}.hex(),
  "Biz-Api-Nonce": {Nonce},
  "Biz-Api-Signature": {YOUR_API_SIGNATURE}.hex(),
}
```

- Biz-Api-Key: The API key used for the request. For more details, refer to [API key](#api-key).
- Biz-Api-Nonce: The nonce. A nonce is the current time in Unix timestamp format, measured in milliseconds.
- Biz-Api-Signature: The API signature. To learn how to calculate an API signature, see [Calculate an API Signature](#calculate-the-api-signature).

If you are using Cobo's WaaS SDKs, you only need to provide your API secret because the SDKs handles the remaining steps for you. For more details, refer to [API secret](#api-secret).

<Warning>
Important: For Python implementations, we recommend using PyNaCl library for Ed25519 key operations. The ed25519 library has compatibility issues with Python 3.12+.
</Warning>

## API key and API secret

To enable secure and authenticated communication between clients and the WaaS 2.0 service, a mechanism based on the API key and API secret is used. This mechanism relies on cryptographic key pairs to verify the identity of the client and the integrity of the requests.

### API key

The API key is the public key in the cryptographic key pair. It is used to identify the client making the API request.

The API key is associated with permissions and wallet scopes, which define the actions the client can perform and the wallets they can access. Different API keys can be assigned with varying permissions and wallet scopes, providing granular control over client capabilities.
<Info>For more details about permissions and wallet scopes, see [Permissions and wallet scopes](/v2/guides/overview/permissions-and-wallet-scopes).</Info>

### API secret

The API secret is the private key in the key pair. It is used to sign API requests, guaranteeing their authenticity and integrity. The API secret must always remain confidential and secure to prevent unauthorized access.

The API key and API secret work as a pair to secure communication with the WaaS 2.0 service:

- The API key is included in API requests to identify the client to the WaaS service. It is required to be registered on Cobo Portal. For more information, refer to [Register an API key](https://manuals.cobo.com/en/portal/developer-console/create-api-key).
- The API secret is used to generate a signature for each API request. The WaaS service validates the signature to confirm the requestâ€™s authenticity and prevent tampering.

### Generate an API key and an API secret

This section introduces three methods to generate an API key and an API secret using the Ed25519 algorithm. Each method has its own advantages and considerations.

<Warning>
Security Best Practices:
- Set appropriate file permissions: `chmod 600` for private key files
- Store keys securely, preferably using environment variables
- Never share or expose your private key
- Consider using a hardware security module (HSM) for production environments
- Regularly rotate your API keys
</Warning>

#### Use Cobo CLI

Cobo Command Line Interface (CLI) is a powerful developer tool designed to help you build, test, and manage your integration with Cobo Wallet-as-a-Service (WaaS) 2.0 directly from the command line.

1. Install Cobo CLI using the following command:

    ```shell
    # Install Cobo CLI using pip (Python 3.9 or newer is required).
    pip install cobo-cli
    # Alternatively, you can install Cobo CLI using Homebrew.
    brew install cobo-cli
    # Test if the installation is successful
    cobo version
    ```

    For more details about the system requirements for Cobo CLI, please refer to [Install Cobo CLI](/v2/developer-tools/cobo-cli/quick-start-guide#system-requirements).

2. Use the `keys generate` command to generate an API key and an API secret as follows:

    ```shell
    # Generate an API key and an API secret
    cobo keys generate --key-type API
    ```

    Generated keys are securely stored in your configuration file (default: `~/.cobo/config.toml`). For more information about this command, refer to [Key management](/v2/developer-tools/cobo-cli/key-management).

#### Use OpenSSL

In a terminal window, run the following OpenSSL commands:

```shell
# Generate a private key and save it in the `private.key.pem` file.
openssl genpkey -algorithm ed25519 -out private_key.pem

# Extract the public key from the private key and save it in the `public.key.pem` file.
openssl pkey -in private_key.pem -pubout -out public_key.pem

# Export the private key in hexadecimal format.
openssl pkey -in private_key.pem -text | grep 'priv:' -A 3 | tail -n +2 | tr -d ':\n '

# Export the public key in hexadecimal format.
openssl pkey -pubin -in public_key.pem -text | grep 'pub:' -A 3 | tail -n +2 | tr -d ':\n '
```

The private key is saved in the `private.key.pem` file, and the public key is saved in the `public.key.pem` file.

#### Use the Python library

1. Install the `PyNaCl` library:

   ```shell
   pip install PyNaCl
   ```

2. Generate a key pair using the following Python code:

   ```python
   from nacl.signing import SigningKey

   # Create a signing key (this will be your API secret)
   sk = SigningKey.generate()

   # Get the verify key (this will be your API key)
   vk = sk.verify_key

   # Print the keys in hexadecimal format
   print("API Secret (private key):", sk.encode().hex())
   print("API Key (public key):", vk.encode().hex())
   ```

### Register the API key

After generating an API key, you need to register the key and configure related permissions on Cobo Portal. To learn how to register an API key, see [Register an API key](https://manuals.cobo.com/en/portal/developer-console/create-api-key).

## Nonce

A nonce is the current time in Unix timestamp format, measured in milliseconds.

## Calculate the API signature

The following steps explain how to calculate an API signature for authenticating your requests:

1. Concatenate the request components into a string:

   ```python
   str_to_sign = f"{METHOD}|{PATH}|{TIMESTAMP}|{PARAMS}|{BODY}"
   ```

   Where:
   | Field | Description | Example |
   |-------|-------------|---------|
   | METHOD | HTTP method | `GET` |
   | PATH | API endpoint | `/v2/transactions/transfer` |
   | TIMESTAMP | Unix timestamp in milliseconds (same as nonce) | `1718587017026` |
   | PARAMS | Query parameters (if any) | `chain_id=ETH&limit=10` |
   | BODY | Request body as string (if any) | `{"name":"Default"}` |

2. Calculate double SHA-256 hash:

   ```python
   import hashlib

   def calculate_signature(str_to_sign, api_secret):
       # Double SHA-256 hash
       content_hash = hashlib.sha256(hashlib.sha256(str_to_sign.encode()).digest()).digest()

       # Create signing key from API secret
       from nacl.signing import SigningKey
       sk = SigningKey(bytes.fromhex(api_secret))

       # Sign the hashed message
       signature = sk.sign(content_hash)

       return signature.signature.hex()
   ```

   Example usage:
   ```python
   str_to_sign = "GET|/v2/transactions/transfer|1718587017026|chain_id=ETH&limit=10|"
   api_secret = "your_api_secret_here"
   signature = calculate_signature(str_to_sign, api_secret)
   print("API signature:", signature)
   ```

## Troubleshooting

Common issues and solutions:

1. Invalid Signature Errors
   - Verify the timestamp matches exactly between the nonce and signature calculation
   - Ensure all string components are in the correct order
   - Check for any extra whitespace in the signature string

2. Key Generation Issues
   - For OpenSSL: Ensure version 3.0.2+ is installed
   - For Python: Use PyNaCl for modern Python versions
   - For Cobo CLI: Verify proper installation and permissions

3. Best Practices
   - Implement proper error handling in your code
   - Use environment variables for storing sensitive keys
   - Regularly rotate your API keys
   - Monitor API usage patterns for security

<Tip>Feel free to [share your feedback](https://forms.zohopublic.com/cobo/form/DocumentFeedbackForm/formperma/QvLOhxJv1_JMsJ-1dleZ8Itb_7rzN-LtgvsDdxosoVI) to improve our documentation!</Tip>
